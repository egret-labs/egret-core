var __define=this.__define||function(e,t,r,n){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:r,set:n})},egret;!function(e){e.VersionController}(egret||(egret={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},egret;!function(e){var t;!function(t){var r=function(t){function r(){t.call(this),this._versionInfo={},this._versionPath="",this._localFileArr=[]}__extends(r,t);var n=r;return p=n.prototype,p.fetchVersion=function(){var t=this;if(t._versionPath="all.manifest",t._versionInfo=t.getLocalData(t._versionPath),null==t._versionInfo)return void e.callLater(function(){t.dispatchEvent(new e.IOErrorEvent(e.IOErrorEvent.IO_ERROR))},t);var r=0,n=function(n){if(n)for(var i=0;i<n.length;i++)n[i]&&""!=n[i]&&t._localFileArr.push("resource/"+n[i]);r++,2==r&&t.dispatchEvent(new e.Event(e.Event.COMPLETE))};t.getList(n,"assets","resource"),t.getList(n,"update","resource")},p.getList=function(t,r,n){void 0===n&&(n="");var i=e.PromiseObject.create();i.onSuccessFunc=function(e){t(e)},i.onErrorFunc=function(){console.error("list files error")},"assets"==r?egret_native.Game.listResource(n,i):egret_native.Game.listUpdate(n,i)},p.getChangeList=function(){var e=[],t=this._localFileArr;for(var r in this._versionInfo)t.indexOf(this.getVirtualUrl(r))<0&&e.push({url:this.getVirtualUrl(r),size:this._versionInfo[r].s});return e},p.getVirtualUrl=function(e){return this._versionInfo&&this._versionInfo[e]?"resource/"+this._versionInfo[e].v.substring(0,2)+"/"+this._versionInfo[e].v+"_"+this._versionInfo[e].s:e},p.getLocalData=function(e){if(egret_native.readUpdateFileSync&&egret_native.readResourceFileSync){var t=egret_native.readUpdateFileSync(e);if(null!=t)return JSON.parse(t);if(t=egret_native.readResourceFileSync(e),null!=t)return JSON.parse(t)}return null},r}(e.EventDispatcher);t.NativeVersionController=r,e.registerClass(r,"egret.native.NativeVersionController",["egret.VersionController","egret.IVersionController","egret.IEventDispatcher"]),e.Capabilities.runtimeType==e.RuntimeType.NATIVE&&(e.VersionController=r)}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){t.call(this),this._versionInfo={}}__extends(r,t);var n=r;return p=n.prototype,p.fetchVersion=function(){function t(e){n(),i.dispatchEvent(e)}function r(){n(),i._versionInfo=JSON.parse(s.response),window.setTimeout(function(){i.dispatchEvent(new e.Event(e.Event.COMPLETE))},0)}function n(){s.removeEventListener(e.Event.COMPLETE,r,i),s.removeEventListener(e.IOErrorEvent.IO_ERROR,t,i)}var i=this,o="all.manifest",s=new e.HttpRequest;s.addEventListener(e.Event.COMPLETE,r,this),s.addEventListener(e.IOErrorEvent.IO_ERROR,t,this),s.open(o+"?r="+Date.now(),"get"),s.send()},p.getChangeList=function(){return[]},p.getVirtualUrl=function(e){return this._versionInfo&&this._versionInfo[e]?"resource/"+this._versionInfo[e].v.substring(0,2)+"/"+this._versionInfo[e].v+"_"+this._versionInfo[e].s:e},r}(e.EventDispatcher);t.Html5VersionController=r,e.registerClass(r,"egret.web.Html5VersionController",["egret.VersionController","egret.IVersionController","egret.IEventDispatcher"]),e.Capabilities.runtimeType==e.RuntimeType.WEB&&(e.VersionController=r)}(t=e.web||(e.web={}))}(egret||(egret={}));