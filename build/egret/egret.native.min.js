var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},__define=this.__define||function(e,t,i,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:r})},egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this.loaded=!1}__extends(r,i);var n=r;return p=n.prototype,p.load=function(t){function i(){c.load(),r.$recycle(this.url,c)}function n(){s(),o.loaded=!0,o.dispatchEventWith(e.Event.COMPLETE)}function a(){s(),o.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}function s(){c.removeEventListener("canplaythrough",i),c.removeEventListener("error",a)}var o=this;this.url=t;var h=e.PromiseObject.create();h.onSuccessFunc=i,h.onErrorFunc=a,egret_native.download(t,t,h);var c=new Audio(t);c.addEventListener("canplaythrough",n),c.addEventListener("error",a),this.originAudio=c},p.play=function(e,i){e=+e||0,i=+i||0;var n=r.$pop(this.url);null==n?n=new Audio(this.url):n.load(),n.autoplay=!0;var a=new t.NativeSoundChannel(n);return a.$url=this.url,a.$loops=i,a.$startTime=e,a.$play(),a},p.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),r.$clear(this.url)},r.$clear=function(e){var t=r.audios[e];t&&(t.length=0)},r.$pop=function(e){var t=r.audios[e];return t&&t.length>0?t.pop():null},r.$recycle=function(e,t){var i=r.audios[e];null==r.audios[e]&&(i=r.audios[e]=[]),i.push(t)},r.MUSIC="music",r.EFFECT="effect",r.audios={},r}(e.EventDispatcher);t.NativeSound=i,e.registerClass(i,"egret.web.NativeSound",["egret.Sound"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i={"source-over":[1,771],lighter:[770,1],"destination-out":[0,771],"destination-in":[0,770]},r=function(t){function r(){t.apply(this,arguments),this.$matrix=new e.Matrix,this.$globalCompositeOperation="source-over",this.$globalAlpha=1,this.$lineWidth=0,this.$strokeStyle="#000000",this.$fillStyle="#000000",this.$font="10px sans-serif",this.$fontSize=10,this.$saveList=[],this.$clipRect=new e.Rectangle,this.$saveCount=0,this.$clipList=[],this.$hasStrokeText=!1}__extends(r,t);var n=__define,a=r;return p=a.prototype,n(p,"globalCompositeOperation",function(){return this.$globalCompositeOperation},function(e){this.$globalCompositeOperation=e;var t=i[e];t&&egret_native.Graphics.setBlendArg(t[0],t[1])}),n(p,"globalAlpha",function(){return this.$globalAlpha},function(e){this.$globalAlpha=e,egret_native.Graphics.setGlobalAlpha(e)}),n(p,"lineWidth",function(){return this.$lineWidth},function(e){this.$lineWidth=e,egret_native.rastergl.lineWidth=e}),n(p,"strokeStyle",function(){return this.$strokeStyle},function(e){-1!=e.indexOf("rgba")?e=this.$parseRGBA(e):-1!=e.indexOf("rgb")&&(e=this.$parseRGB(e)),this.$strokeStyle=e,egret_native.Label.setStrokeColor(parseInt(e.replace("#","0x"))),egret_native.rastergl.strokeStyle=e}),n(p,"fillStyle",function(){return this.$fillStyle},function(e){-1!=e.indexOf("rgba")?e=this.$parseRGBA(e):-1!=e.indexOf("rgb")&&(e=this.$parseRGB(e)),this.$fillStyle=e,egret_native.Label.setTextColor(parseInt(e.replace("#","0x"))),egret_native.rastergl.fillStyle=e}),p.$fillColorStr=function(e){return e.length<2&&(e="0"+e),e},p.$parseRGBA=function(e){var t=e.indexOf("(");e=e.slice(t+1,e.length-1);var i=e.split(","),r=parseInt(255*parseFloat(i[3])).toString(16),n=parseInt(i[0]).toString(16),a=parseInt(i[1]).toString(16),s=parseInt(i[2]).toString(16);return e="#"+this.$fillColorStr(r)+this.$fillColorStr(n)+this.$fillColorStr(a)+this.$fillColorStr(s)},p.$parseRGB=function(e){var t=e.indexOf("(");e=e.slice(t+1,e.length-1);var i=e.split(","),r=parseInt(i[0]).toString(16),n=parseInt(i[1]).toString(16),a=parseInt(i[2]).toString(16);return e="#"+this.$fillColorStr(r)+this.$fillColorStr(n)+this.$fillColorStr(a)},n(p,"font",function(){return this.$font},function(e){this.$font=e;for(var t=e.split(" "),i=t.length,r=0;i>r;r++){var n=t[r];if(-1!=n.indexOf("px"))return void(this.$fontSize=parseInt(n.replace("px","")))}}),p.arc=function(e,t,i,r,n,a){egret_native.rastergl.arc(e,t,i,r,n,a)},p.quadraticCurveTo=function(e,t,i,r){egret_native.rastergl.quadraticCurveTo(e,t,i,r)},p.lineTo=function(e,t){egret_native.rastergl.lineTo(e,t)},p.fill=function(e){egret_native.rastergl.fill(e)},p.closePath=function(){egret_native.rastergl.closePath()},p.rect=function(e,t,i,r){egret_native.rastergl.rect(e,t,i,r),this.$clipRect.setTo(e,t,i,r)},p.moveTo=function(e,t){egret_native.rastergl.moveTo(e,t)},p.fillRect=function(e,t,i,r){egret_native.rastergl.fillRect(e,t,i,r)},p.bezierCurveTo=function(e,t,i,r,n,a){egret_native.rastergl.bezierCurveTo(e,t,i,r,n,a)},p.stroke=function(){egret_native.rastergl.stroke()},p.strokeRect=function(e,t,i,r){egret_native.rastergl.strokeRect(e,t,i,r)},p.beginPath=function(){egret_native.rastergl.beginPath()},p.arcTo=function(e,t,i,r,n){egret_native.rastergl.arcTo(e,t,i,r,n)},p.transform=function(e,t,i,r,n,a){this.$matrix.append(e,t,i,r,n,a),this.setTransformToNative()},p.translate=function(e,t){this.$matrix.translate(e,t),this.setTransformToNative()},p.scale=function(e,t){this.$matrix.scale(e,t),this.setTransformToNative()},p.rotate=function(e){this.$matrix.rotate(e),this.setTransformToNative()},p.restore=function(){if(this.$saveCount>0){if(this.$saveList.length){var e=this.$saveList.pop();for(var t in e)this[t]=e[t];this.setTransformToNative()}var i=this.$clipList.indexOf(this.$saveCount);if(-1!=i){var r=this.$clipList.length;for(this.$clipList.splice(i,r-i);r>i;i++)egret_native.Graphics.popClip()}this.$saveCount--}},p.save=function(){var t=new e.Matrix;t.copyFrom(this.$matrix),this.$saveList.push({lineWidth:this.$lineWidth,globalCompositeOperation:this.$globalCompositeOperation,globalAlpha:this.$globalAlpha,strokeStyle:this.$strokeStyle,fillStyle:this.$fillStyle,font:this.$font,$matrix:t}),this.$saveCount++},p.clip=function(){this.$clipRect.width>0&&this.$clipRect.height>0&&(egret_native.Graphics.pushClip(this.$clipRect.x,this.$clipRect.y,this.$clipRect.width,this.$clipRect.height),this.$clipRect.setEmpty(),this.$clipList.push(this.$saveCount))},p.clearRect=function(){egret_native.Graphics.clearScreen(1,0,0)},p.setTransform=function(e,t,i,r,n,a){this.$matrix.setTo(e,t,i,r,n,a),this.setTransformToNative()},p.setTransformToNative=function(){var e=this.$matrix;egret_native.Graphics.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty)},p.createLinearGradient=function(e,t,i,r){return egret_native.rastergl.createLinearGradient(e,t,i,r)},p.createRadialGradient=function(e,t,i,r,n,a){return egret_native.rastergl.createRadialGradient(e,t,i,r,n,a)},p.fillText=function(t,i,r){var n=e.TextField.default_fontFamily;egret_native.Label.createLabel(n,this.$fontSize,"",this.$hasStrokeText?this.$lineWidth:0),this.$hasStrokeText=!1,egret_native.Label.drawText(t,i,r)},p.strokeText=function(){this.$hasStrokeText=!0},p.measureText=function(t){var i=e.TextField.default_fontFamily;return egret_native.Label.createLabel(i,this.$fontSize,"",this.$hasStrokeText?this.$lineWidth:0),{width:egret_native.Label.getTextSize(t)[0]}},p.drawImage=function(e,t,i,r,n,a,s,o,h){var c;c=e.$nativeRenderTexture?e.$nativeRenderTexture:e,c&&c.avaliable&&(3==arguments.length?(a=t,s=i,t=0,i=0,r=o=e.width,n=h=e.height):(r||(r=e.width),n||(n=e.height),a||(a=0),s||(s=0),o||(o=r),h||(h=n)),egret_native.Graphics.drawImage(c,t,i,r,n,a,s,o,h))},p.createPattern=function(){return null},p.getImageData=function(e,t,i,r){return{width:i,height:r,data:null}},p.begin=function(){this.surface.begin()},p.end=function(){this.surface.end()},r}(e.HashObject);t.NativeRenderContext=r,e.registerClass(r,"egret.native.NativeRenderContext",["egret.sys.RenderContext"])}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=[],r=["source-over","lighter","destination-out"],n="source-over",a=function(a){function s(i){a.call(this),this.$isDirty=!1,this.$renderAlpha=1,this.$renderMatrix=new e.Matrix,this.$ratioMatrix=new e.Matrix,this.$ratioChanged=!1,this.$pixelRatio=1,this.$renderRegion=new t.Region,this.surface=null,this.offsetX=0,this.offsetY=0,this.needRedraw=!1,this.rootMatrix=new e.Matrix,this.dirtyNodes={},this.dirtyNodeList=[],this.dirtyList=null,this.dirtyRegion=new t.DirtyRegion,this.sizeChanged=!1,this.root=i}__extends(s,a);var o=s;return p=o.prototype,s.release=function(r){t.surfaceFactory.release(r.surface),e.Matrix.release(r.$renderMatrix),e.Matrix.release(r.$ratioMatrix),r.surface=null,r.renderContext=null,r.root=null,r.$renderMatrix=null,r.$ratioMatrix=null,r.needRedraw=!1,r.$isDirty=!1,i.push(r)},s.create=function(r){var n=i.pop();n||(n=new e.sys.DisplayList(r));var a=t.surfaceFactory.create();return a?(n.surface=a,n.renderContext=a.renderContext,n.root=r,n.$renderMatrix=e.Matrix.create(),n.$renderMatrix.setTo(1,0,0,1,0,0),n.$pixelRatio=1,n.$ratioMatrix=e.Matrix.create(),n.$ratioMatrix.setTo(1,0,0,1,0,0),n.needRedraw=!0,n.$isDirty=!0,n):null},p.$update=function(){var e=this.root;if(null==e)return!1;e.$removeFlagsUp(768),this.$renderAlpha=e.$getConcatenatedAlpha();var t=e.$getConcatenatedMatrix(),i=e.$getOriginalBounds(),r=e.$parentDisplayList,n=1;r?n=r.$pixelRatio:e.stage&&e.stage.$displayList&&(n=e.stage.$displayList.$pixelRatio),this.setDevicePixelRatio(n);var a=this.$renderRegion;if(this.needRedraw&&this.updateDirtyRegions(),!r)return a.setTo(0,0,0,0),a.moved=!1,!1;if(!a.moved&&!r.$ratioChanged)return!1;a.moved=!1;var s=this.$renderMatrix;s.copyFrom(t);var o=r.root;return o!==e.$stage&&e.$getConcatenatedMatrixAt(o,s),this.$ratioMatrix.$preMultiplyInto(s,s),a.updateRegion(i,s),!0},p.$render=function(e){var t=this.surface;t&&(e.begin(),e.drawImage(t,this.offsetX,this.offsetY,t.width/this.$pixelRatio,t.height/this.$pixelRatio),e.end())},p.setClipRect=function(e,t){e*=this.$pixelRatio,t*=this.$pixelRatio,this.dirtyRegion.setClipRect(e,t),this.rootMatrix=null;var i=this.renderContext.surface;i.width=e,i.height=t,this.surface=i},p.markDirty=function(e){var t=e.$hashCode;if(!this.dirtyNodes[t]&&(this.dirtyNodes[t]=!0,this.dirtyNodeList.push(e),!this.needRedraw)){this.needRedraw=!0;var i=this.root.$parentDisplayList;i&&i.markDirty(this)}},p.updateDirtyRegions=function(){var e=this.dirtyNodeList;this.dirtyNodeList=[],this.dirtyNodes={};for(var t=this.dirtyRegion,i=e.length,r=0;i>r;r++){var n=e[r],a=n.$renderRegion;n.$renderAlpha>0&&t.addRegion(a)&&(n.$isDirty=!0);var s=n.$update();n.$renderAlpha>0&&(s||!n.$isDirty)&&t.addRegion(a)&&(n.$isDirty=!0)}return this.dirtyList=t.getDirtyRegions(),this.dirtyList},p.drawToSurface=function(){var e=this.rootMatrix;e&&this.changeSurfaceSize();var t=this.renderContext;t.begin(),t.save(),t.beginPath(),e&&t.setTransform(1,0,0,1,-this.offsetX*this.$pixelRatio,-this.offsetY*this.$pixelRatio);var i=this.dirtyList;this.dirtyList=null;for(var r=i.length,n=0;r>n;n++){var a=i[n];t.clearRect(a.minX,a.minY,a.width,a.height),t.rect(a.minX,a.minY,a.width,a.height)}t.clip(),e&&t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.end();var s=this.drawDisplayObject(this.root,t,i,e,null,null);return t.begin(),t.restore(),t.end(),this.dirtyRegion.clear(),this.needRedraw=!1,this.$ratioChanged=!1,s},p.drawDisplayObject=function(e,t,i,r,n,a){var s,o,h=0;if(n?(n.needRedraw&&(h+=n.drawToSurface()),s=n,o=1):e.$renderRegion&&(s=e,o=e.$renderAlpha),s){var c=s.$renderRegion;if(a&&!a.intersects(c))s.$isDirty=!1;else if(!s.$isDirty)for(var l=i.length,u=0;l>u;u++)if(c.intersects(i[u])){s.$isDirty=!0;break}if(s.$isDirty){h++,t.begin(),t.globalAlpha=o;var d=s.$renderMatrix;r?(t.transform(d.a,d.b,d.c,d.d,d.tx,d.ty),s.$render(t),t.setTransform(r.a,r.b,r.c,r.d,r.tx*this.$pixelRatio,r.ty*this.$pixelRatio)):(t.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty),s.$render(t)),t.end(),s.$isDirty=!1}}if(n)return h;var p=e.$children;if(p)for(var v=p.length,f=0;v>f;f++){var g=p[f];!g.$visible||g.$alpha<=0||g.$maskedObject||(h+=0!==g.$blendMode||g.$mask&&g.$mask.$parentDisplayList?this.drawWithClip(g,t,i,r,a):g.$scrollRect||g.$maskRect?this.drawWithScrollRect(g,t,i,r,a):this.drawDisplayObject(g,t,i,r,g.$displayList,a))}return h},p.drawWithClip=function(i,a,s,o,h){var c=0,l=0!==i.$blendMode;if(l){var u=r[i.$blendMode];u||(u=n)}var d=i.$scrollRect?i.$scrollRect:i.$maskRect,p=i.$mask;p&&!p.$parentDisplayList&&(p=null);var v,f=e.Matrix.create();f.copyFrom(i.$getConcatenatedMatrix());var g,$=i.$parentDisplayList.root;if($!==i.$stage&&(g=$.$getInvertedConcatenatedMatrix(),g.$preMultiplyInto(f,f)),this.$ratioMatrix.$preMultiplyInto(f,f),p){var x=p.$getOriginalBounds();v=t.Region.create();var y=e.Matrix.create();y.copyFrom(p.$getConcatenatedMatrix()),g&&g.$preMultiplyInto(y,y),this.$ratioMatrix.$preMultiplyInto(y,y),v.updateRegion(x,y),e.Matrix.release(y)}var R;if(d&&(R=t.Region.create(),R.updateRegion(d,f)),R&&v?(R.intersect(v),t.Region.release(v)):!R&&v&&(R=v),R){if(R.isEmpty()||h&&!h.intersects(R))return t.Region.release(R),e.Matrix.release(f),c}else R=t.Region.create(),x=i.$getOriginalBounds(),R.updateRegion(x,f);for(var T=!1,m=s.length,_=0;m>_;_++)if(R.intersects(s[_])){T=!0;break}if(!T)return t.Region.release(R),e.Matrix.release(f),c;var w=this.createRenderContext(R.width,R.height);if(!w)return c+=this.drawDisplayObject(i,a,s,o,i.$displayList,h),t.Region.release(R),e.Matrix.release(f),c;if(w.begin(),d){var y=f;w.setTransform(y.a,y.b,y.c,y.d,y.tx-R.minX,y.ty-R.minY),w.beginPath(),w.rect(d.x,d.y,d.width,d.height),w.clip()}w.setTransform(1,0,0,1,-R.minX,-R.minY),w.end();var b=e.Matrix.create().setTo(1,0,0,1,-R.minX,-R.minY);if(c+=this.drawDisplayObject(i,w,s,b,i.$displayList,R),e.Matrix.release(b),p){var E=this.createRenderContext(R.width,R.height);if(!E)return c+=this.drawDisplayObject(i,a,s,o,i.$displayList,h),t.surfaceFactory.release(w.surface),t.Region.release(R),e.Matrix.release(f),c;E.begin(),E.setTransform(1,0,0,1,-R.minX,-R.minY),E.end(),b=e.Matrix.create().setTo(1,0,0,1,-R.minX,-R.minY);var C=this.drawDisplayObject(p,E,s,b,p.$displayList,R);e.Matrix.release(b),C>0&&(c+=C,w.begin(),w.globalCompositeOperation="destination-in",w.setTransform(1,0,0,1,0,0),w.globalAlpha=1,w.drawImage(E.surface,0,0),w.end()),t.surfaceFactory.release(E.surface)}return c>0&&(c++,a.begin(),l&&(a.globalCompositeOperation=u),o?(a.translate(R.minX,R.minY),a.drawImage(w.surface,0,0),a.setTransform(o.a,o.b,o.c,o.d,o.tx*this.$pixelRatio,o.ty*this.$pixelRatio)):(a.setTransform(1,0,0,1,R.minX,R.minY),a.drawImage(w.surface,0,0)),l&&(a.globalCompositeOperation=n),a.end()),t.surfaceFactory.release(w.surface),t.Region.release(R),e.Matrix.release(f),c},p.drawWithScrollRect=function(i,r,n,a,s){var o=0,h=i.$scrollRect?i.$scrollRect:i.$maskRect,c=e.Matrix.create();c.copyFrom(i.$getConcatenatedMatrix());var l=i.$parentDisplayList.root;l!==i.$stage&&l.$getInvertedConcatenatedMatrix().$preMultiplyInto(c,c),this.$ratioMatrix.$preMultiplyInto(c,c);var u=t.Region.create();if(h.isEmpty()||u.updateRegion(h,c),u.isEmpty()||s&&!s.intersects(u))return t.Region.release(u),e.Matrix.release(c),o;for(var d=!1,p=n.length,v=0;p>v;v++)if(u.intersects(n[v])){d=!0;break}return d?(r.begin(),r.save(),a?(r.setTransform(a.a,a.b,a.c,a.d,a.tx*this.$pixelRatio,a.ty*this.$pixelRatio),r.transform(c.a,c.b,c.c,c.d,c.tx,c.ty)):r.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty),r.beginPath(),r.rect(h.x,h.y,h.width,h.height),r.clip(),a&&r.setTransform(a.a,a.b,a.c,a.d,a.tx*this.$pixelRatio,a.ty*this.$pixelRatio),r.end(),o+=this.drawDisplayObject(i,r,n,a,i.$displayList,u),r.begin(),r.restore(),r.end(),t.Region.release(u),e.Matrix.release(c),o):(t.Region.release(u),e.Matrix.release(c),o)},p.createRenderContext=function(i,r){var n=t.surfaceFactory.create(!0);return n?(e.Capabilities.runtimeType==e.RuntimeType.WEB?(n.width=Math.max(257,i),n.height=Math.max(257,r)):(n.width=i,n.height=r),n.renderContext):null},p.changeSurfaceSize=function(){var e=(this.root,this.offsetX),i=this.offsetY,r=this.root.$getOriginalBounds(),n=this.$pixelRatio,a=this.$pixelRatio;this.offsetX=r.x,this.offsetY=r.y;var s=this.renderContext,o=s.surface;if(this.sizeChanged){var h=t.sharedRenderContext,c=h.surface;t.sharedRenderContext=s,this.renderContext=h,this.surface=c,c.width=r.width*n,c.height=r.height*a,0!==o.width&&0!==o.height&&(h.begin(),h.setTransform(1,0,0,1,0,0),h.drawImage(o,(e-this.offsetX)*n,(i-this.offsetY)*a),h.end()),o.height=1,o.width=1}else this.sizeChanged=!0,o.width=r.width*n,o.height=r.height*a;this.rootMatrix.setTo(1,0,0,1,-this.offsetX,-this.offsetY),this.renderContext.begin(),this.renderContext.setTransform(1,0,0,1,-r.x,-r.y),this.renderContext.end()},p.setDevicePixelRatio=function(t){void 0===t&&(t=1),this.$pixelRatio==t&&this.$ratioMatrix||(this.$ratioMatrix||(this.$ratioMatrix=e.Matrix.create()),this.$ratioChanged=!0,this.$pixelRatio=t,this.$ratioMatrix.setTo(t,0,0,t,0,0),this.root.$invalidate(!0))},s}(e.HashObject);t.NativeDisplayList=a,e.registerClass(a,"egret.sys.NativeDisplayList",["egret.sys.Renderable"]),e.sys.DisplayList=e.sys.NativeDisplayList}(t=e.sys||(e.sys={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function i(){e.call(this),this.renderContext=new t.NativeRenderContext,this.$widthReadySet=!1,this.$heightReadySet=!1,this.$isRoot=!1,this.$isDispose=!1}__extends(i,e);var r=__define,n=i;return p=n.prototype,p.toDataURL=function(){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return this.$nativeRenderTexture?this.$nativeRenderTexture.toDataURL.apply(this,arguments):null},p.saveToFile=function(e,t){this.$nativeRenderTexture&&this.$nativeRenderTexture.saveToFile(e,t)},r(p,"width",function(){return this.$width},function(e){this.$width=e,this.$isDispose||(this.$widthReadySet=!0,this.createRenderTexture())}),r(p,"height",function(){return this.$height},function(e){this.$height=e,this.$isDispose||(this.$heightReadySet=!0,this.createRenderTexture())}),p.createRenderTexture=function(){this.$isRoot||this.$widthReadySet&&this.$heightReadySet&&(this.$nativeRenderTexture&&this.$nativeRenderTexture.dispose(),this.$nativeRenderTexture=new egret_native.RenderTexture(this.$width,this.$height),this.$nativeRenderTexture.avaliable=!0,this.$widthReadySet=!1,this.$heightReadySet=!1)},p.begin=function(){this.$nativeRenderTexture&&this.$nativeRenderTexture.begin()},p.end=function(){this.$nativeRenderTexture&&this.$nativeRenderTexture.end()},p.$dispose=function(){this.$nativeRenderTexture&&(this.$nativeRenderTexture.dispose(),this.$nativeRenderTexture=null),this.$isDispose=!0},p.$reload=function(){this.$isDispose=!1},i}(e.HashObject);t.NativeSurface=i,e.registerClass(i,"egret.native.NativeSurface",["egret.sys.Surface","egret.BitmapData"])}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(){function t(t,i){var r=e.sys.surfaceFactory.create(!0);if(!r)return null;var n=t.$getTextureWidth(),a=t.$getTextureHeight();null==i&&(i=e.$TempRectangle,i.x=0,i.y=0,i.width=n,i.height=a),i.x=Math.min(i.x,n-1),i.y=Math.min(i.y,a-1),i.width=Math.min(i.width,n-i.x),i.height=Math.min(i.height,a-i.y);var s=i.width,o=i.height;r.width=s,r.height=o;var h=t,c=r.renderContext;c.begin(),c.imageSmoothingEnabled=!1;var l=Math.round(h._offsetX),u=Math.round(h._offsetY),d=h._bitmapWidth,p=h._bitmapHeight;return c.globalAlpha=1,c.globalCompositeOperation="source-over",c.setTransform(1,0,0,1,0,0),c.drawImage(h._bitmapData,h._bitmapX+i.x/e.$TextureScaleFactor,h._bitmapY+i.y/e.$TextureScaleFactor,d*i.width/n,p*i.height/a,l,u,i.width,i.height),c.end(),r}function i(i,r){try{var n=t(this,r),a=n.toDataURL(i);return n.$dispose(),a}catch(s){return e.$error(1033),null}}function r(i,r,n){try{var a=t(this,n);a.saveToFile(i,r),a.$dispose()}catch(s){e.$error(1033)}}function n(){return e.$error(1035),null}e.Texture.prototype.toDataURL=i,e.Texture.prototype.saveToFile=r,e.Texture.prototype.getPixel32=n}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=[],r=function(){function r(){e.sys.sharedRenderContext=this.create().renderContext;for(var t=0;3>t;t++)i.push(this.create())}var n=r;return p=n.prototype,p.create=function(e){var r=e||i.length>3?i.pop():null;return r||(r=this.createSurface(new t.NativeSurface)),r.$reload(),r},p.release=function(e){e&&(e.$dispose(),e.width=e.height=1,i.push(e))},p.createSurface=function(e){var t=e.renderContext;return t.surface=e,e},r}();t.OpenGLFactory=r,e.registerClass(r,"egret.native.OpenGLFactory",["egret.sys.SurfaceFactory"])}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this.init(r.option)}__extends(r,i);var n=r;return p=n.prototype,p.init=function(i){i.showPaintRect=!1;var r=new e.Stage;r.$screen=this,r.$scaleMode=i.scaleMode,r.$maxTouches=i.maxTouches,r.frameRate=i.frameRate,r.textureScaleFactor=i.textureScaleFactor;var n=e.sys.surfaceFactory.create();n.$isRoot=!0;var a=new t.NativeTouchHandler(r),s=new e.sys.Player(n.renderContext,r,i.entryClassName);new t.NativeHideHandler(r);this.playerOption=i,this.stage=r,this.player=s,this.nativeTouch=a,this.updateScreenSize(),this.updateMaxTouches(),s.start()},p.updateScreenSize=function(){var t=this.playerOption,i=egret_native.EGTView.getFrameWidth(),r=egret_native.EGTView.getFrameHeight(),n=e.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,i,r,t.contentWidth,t.contentHeight),a=n.stageWidth,s=n.stageHeight,o=n.displayWidth,h=n.displayHeight,c=(r-h)/2,l=(i-o)/2;egret_native.EGTView.setVisibleRect(l,c,o,h),egret_native.EGTView.setDesignSize(a,s),this.player.updateStageSize(a,s)},p.updateMaxTouches=function(){this.nativeTouch.$updateMaxTouches()},r}(e.HashObject);t.NativePlayer=i,e.registerClass(i,"egret.native.NativePlayer",["egret.sys.Screen"])}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(){var i=e.sys.$ticker,r=function(){i.update()};egret_native.executeMainLoop(r,i),e.sys.surfaceFactory=new t.OpenGLFactory,e.sys.screenAdapter||(e.sys.screenAdapter=new e.sys.ScreenAdapter),new t.NativePlayer}function r(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i]);return t}e.warn=function(){console.warn.apply(console,r(arguments))},e.error=function(){console.error.apply(console,r(arguments))},e.assert=function(){console.assert.apply(console,r(arguments))},e.log=function(){console.log.apply(console,r(arguments))},e.runEgret=i}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e){return egret_native.getOption(e)}t.getOption=i,e.getOption=i}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(t){var i=JSON.parse(t),n=i.functionName,a=r[n];if(a){var s=i.value;a.call(null,s)}else e.$warn(1004,n)}var r={},n=function(){function e(){}var t=e;return p=t.prototype,e.call=function(e,t){var i={};i.functionName=e,i.value=t,egret_native.sendInfoToPlugin(JSON.stringify(i))},e.addCallback=function(e,t){r[e]=t},e}();t.NativeExternalInterface=n,e.registerClass(n,"egret.native.NativeExternalInterface",["egret.ExternalInterface"]),e.ExternalInterface=n,egret_native.receivedPluginInfo=i}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i;!function(){function i(e){return h[e]}function r(t,i){h[t]=i;try{return this.save(),!0}catch(r){return e.$warn(1018,t,i),!1}}function n(e){delete h[e],s()}function a(){for(var e in h)delete h[e];s()}function s(){egret_native.saveRecord(o,JSON.stringify(h))}var o="LocalStorage.local",h={};if(egret_native.isRecordExists(o)){var c=egret_native.loadRecord(o);h=JSON.parse(c)}else h={};t.getItem=i,t.setItem=r,t.removeItem=n,t.clear=a}(i=t["native"]||(t["native"]={}))}(t=e.localStorage||(e.localStorage={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(t){var r=this;i.call(this),this.$startTime=0,this.audio=null,this.isStopped=!1,this.onPlayEnd=function(){return 1==r.$loops?(r.stop(),void r.dispatchEventWith(e.Event.SOUND_COMPLETE)):(r.$loops>0&&r.$loops--,r.audio.load(),void r.$play())},t.addEventListener("ended",this.onPlayEnd),this.audio=t}__extends(r,i);var n=__define,a=r;return p=a.prototype,p.$play=function(){if(this.isStopped)return void e.$error(1036);try{this.audio.currentTime=this.$startTime}catch(t){}finally{this.audio.play()}},p.stop=function(){if(this.audio){var e=this.audio;e.pause(),e.removeEventListener("ended",this.onPlayEnd),this.audio=null,t.NativeSound.$recycle(this.$url,e)}},n(p,"volume",function(){return this.audio?this.audio.volume:1},function(t){return this.isStopped?void e.$error(1036):void(this.audio&&(this.audio.volume=t))}),n(p,"position",function(){return this.audio?this.audio.currentTime:0}),r}(e.EventDispatcher);t.NativeSoundChannel=i,e.registerClass(i,"egret.web.NativeSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i){t.call(this),egret_native.pauseApp=function(){i.dispatchEvent(new e.Event(e.Event.DEACTIVATE)),egret_native.Audio.pauseBackgroundMusic(),egret_native.Audio.pauseAllEffects()},egret_native.resumeApp=function(){i.dispatchEvent(new e.Event(e.Event.ACTIVATE)),egret_native.Audio.resumeBackgroundMusic(),egret_native.Audio.resumeAllEffects()}}__extends(i,t);var r=i;return p=r.prototype,i}(e.HashObject);t.NativeHideHandler=i,e.registerClass(i,"egret.native.NativeHideHandler")}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t=function(t){function i(){t.apply(this,arguments),this._downCount=0,this._path=null,this._bytesTotal=0}__extends(i,t);var r=i;return p=r.prototype,p.load=function(e,t){this._downCount=0,this._path=e,this._bytesTotal=t,this.reload()},p.reload=function(){if(this._downCount>=3)return void this.downloadFileError();this._downCount++;var t=e.PromiseObject.create(),i=this;t.onSuccessFunc=function(){i.loadOver()},t.onErrorFunc=function(){i.reload()},t.downloadingSizeFunc=function(e){i.downloadingProgress(e)},egret_native.download(this._path,this._path,t)},p.downloadingProgress=function(t){e.ProgressEvent.dispatchProgressEvent(this,e.ProgressEvent.PROGRESS,t,this._bytesTotal)},p.downloadFileError=function(){this.dispatchEvent(new e.Event(e.IOErrorEvent.IO_ERROR))},p.loadOver=function(){this.dispatchEvent(new e.Event(e.Event.COMPLETE))},i}(e.EventDispatcher);e.NativeResourceLoader=t,e.registerClass(t,"egret.NativeResourceLoader")}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i){t.call(this),this.$touch=new e.sys.TouchHandler(i);var r=this;egret_native.onTouchesBegin=function(e,t,i,n){r.$executeTouchCallback(e,t,i,n,r.$touch.onTouchBegin)},egret_native.onTouchesMove=function(e,t,i,n){r.$executeTouchCallback(e,t,i,n,r.$touch.onTouchMove)},egret_native.onTouchesEnd=function(e,t,i,n){r.$executeTouchCallback(e,t,i,n,r.$touch.onTouchEnd)},egret_native.onTouchesCancel=function(){}}__extends(i,t);var r=i;return p=r.prototype,p.$executeTouchCallback=function(e,t,i,r,n){for(var a=0;e>a;a++){var s=t[a],o=i[a],h=r[a];n.call(this.$touch,o,h,s)}},p.$updateMaxTouches=function(){this.$touch.$initMaxTouches()},i}(e.HashObject);t.NativeTouchHandler=i,e.registerClass(i,"egret.native.NativeTouchHandler")}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){t.call(this),this._url="",this._method=""}__extends(i,t);var r=__define,n=i;return p=n.prototype,r(p,"response",function(){return this._response}),r(p,"responseType",function(){return this._responseType},function(e){this._responseType=e}),r(p,"withCredentials",function(){return this._withCredentials},function(e){this._withCredentials=e}),p.open=function(e,t){void 0===t&&(t="GET"),this._url=e,this._method=t},p.send=function(){function t(){var t=new e.PromiseObject;t.onSuccessFunc=function(t){n._response=t,e.Event.dispatchEvent(n,e.Event.COMPLETE)},egret_native.readFileAsync(n._url,t)}function i(){var t=e.PromiseObject.create();t.onSuccessFunc=r,t.onErrorFunc=function(){e.Event.dispatchEvent(n,e.IOErrorEvent.IO_ERROR)},egret_native.download(n._url,n._url,t)}function r(){var t=egret_native.readFileSync(n._url);n._response=t,e.Event.dispatchEvent(n,e.Event.COMPLETE)}var n=this;egret_native.isFileExists(n._url)?t():i()},p.abort=function(){},p.getAllResponseHeaders=function(){return""},p.setRequestHeader=function(e,t){this.header=e,this.headerValue=t},p.getResponseHeader=function(){return""},i}(e.EventDispatcher);t.NativeHttpRequest=i,e.registerClass(i,"egret.native.NativeHttpRequest",["egret.HttpRequest"]),e.HttpRequest=i}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.apply(this,arguments),this.data=null,this.crossOrigin=null}__extends(r,i);var n=r;return p=n.prototype,p.load=function(e){this.check(e)},p.check=function(e){var t=this;t.isNetUrl(e)?t.download(e):egret_native.isFileExists(e)?t.loadTexture(e):t.download(e)},p.download=function(t){var i=this,r=e.PromiseObject.create();r.onSuccessFunc=function(){i.loadTexture(t)},r.onErrorFunc=function(){i.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.download(t,t,r)},p.loadTexture=function(i){var r=this,n=new e.PromiseObject;n.onSuccessFunc=function(i){i.avaliable=!0,r.data=t.toBitmapData(i),r.dispatchEventWith(e.Event.COMPLETE)},n.onErrorFunc=function(){r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.Texture.addTextureAsyn(i,n)},p.isNetUrl=function(e){return-1!=e.indexOf("http://")},r}(e.EventDispatcher);t.NativeImageLoader=i,e.registerClass(i,"egret.native.NativeImageLoader",["egret.ImageLoader"]),e.ImageLoader=i}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t=function(t){function i(){t.call(this),this.textValue="",this.isFinishDown=!1,this.textValue=""}__extends(i,t);var r=i;return p=r.prototype,p.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},p.$setText=function(e){return this.textValue=e,!0},p.$onBlur=function(){},p.showScreenKeyboard=function(){var t=this;t.dispatchEvent(new e.Event("focus")),e.Event.dispatchEvent(t,"focus",!1,{showing:!0}),egret_native.EGT_TextInput=function(i){t.$textfield.multiline?t.isFinishDown&&(t.isFinishDown=!1,t.textValue=i,t.dispatchEvent(new e.Event("updateText"))):(t.textValue=i.replace(/[\n|\r]/,""),egret_native.TextInputOp.setKeybordOpen(!1),t.dispatchEvent(new e.Event("updateText")),t.dispatchEvent(new e.Event("blur")))},egret_native.EGT_keyboardFinish=function(){t.$textfield.multiline&&(t.isFinishDown=!0),t.dispatchEvent(new e.Event("blur"))}},p.$show=function(){var e=this;egret_native.EGT_getTextEditerContentText=function(){return e.$getText()},egret_native.EGT_keyboardDidShow=function(){e.showScreenKeyboard(),egret_native.EGT_keyboardDidShow=function(){}};var t=this.$textfield,i=t.multiline?0:6,r=-1,n=1,a=t.maxChars<=0?-1:t.maxChars;egret_native.TextInputOp.setKeybordOpen(!0,JSON.stringify({inputMode:i,inputFlag:r,returnType:n,maxLength:a}))},p.$hide=function(){this.dispatchEvent(new e.Event("blur")),egret_native.TextInputOp.setKeybordOpen(!1)},p.$resetStageText=function(){},p.$addToStage=function(){},p.$removeFromStage=function(){},p.$setTextField=function(e){return this.$textfield=e,!0},i}(e.EventDispatcher);e.NativeStageText=t,e.registerClass(t,"egret.NativeStageText",["egret.StageText"]),e.StageText=t}(egret||(egret={}));