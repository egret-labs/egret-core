var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,n){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:n})},egret;!function(t){var e;!function(e){var i=function(i){function n(){i.call(this),this.loaded=!1}__extends(n,i);var r=n;return p=r.prototype,p.load=function(e){function i(){c.load(),n.$recycle(this.url,c)}function r(){s(),o.loaded=!0,o.dispatchEventWith(t.Event.COMPLETE)}function a(){s(),o.dispatchEventWith(t.IOErrorEvent.IO_ERROR)}function s(){c.removeEventListener("canplaythrough",i),c.removeEventListener("error",a)}var o=this;this.url=e;var h=t.PromiseObject.create();h.onSuccessFunc=i,h.onErrorFunc=a,egret_native.download(e,e,h);var c=new Audio(e);c.addEventListener("canplaythrough",r),c.addEventListener("error",a),this.originAudio=c},p.play=function(t,i){t=+t||0,i=+i||0;var r=n.$pop(this.url);null==r?r=new Audio(this.url):r.load(),r.autoplay=!0;var a=new e.NativeSoundChannel(r);return a.$url=this.url,a.$loops=i,a.$startTime=t,a.$play(),a},p.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),n.$clear(this.url)},n.$clear=function(t){var e=n.audios[t];e&&(e.length=0)},n.$pop=function(t){var e=n.audios[t];return e&&e.length>0?e.pop():null},n.$recycle=function(t,e){var i=n.audios[t];null==n.audios[t]&&(i=n.audios[t]=[]),i.push(e)},n.MUSIC="music",n.EFFECT="effect",n.audios={},n}(t.EventDispatcher);e.NativeSound=i,t.registerClass(i,"egret.web.NativeSound",["egret.Sound"])}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i={"source-over":[1,771],lighter:[770,1],"destination-out":[0,771],"destination-in":[0,770]},n=function(e){function n(){e.apply(this,arguments),this.$matrix=new t.Matrix,this.$nativeContext=egret_native.Graphics,this.$nativeGraphicsContext=egret_native.rastergl,this.$globalCompositeOperation="source-over",this.$globalAlpha=1,this.$lineWidth=0,this.$strokeStyle="#000000",this.$fillStyle="#000000",this.$font="10px sans-serif",this.$fontSize=10,this.$saveList=[],this.$clipRect=new t.Rectangle,this.$saveCount=0,this.$clipList=[],this.$hasStrokeText=!1}__extends(n,e);var r=__define,a=n;return p=a.prototype,r(p,"globalCompositeOperation",function(){return this.$globalCompositeOperation},function(t){this.$globalCompositeOperation=t;var e=i[t];e&&this.$nativeContext.setBlendArg(e[0],e[1])}),r(p,"globalAlpha",function(){return this.$globalAlpha},function(t){this.$globalAlpha=t,this.$nativeContext.setGlobalAlpha(t)}),r(p,"lineWidth",function(){return this.$lineWidth},function(t){this.$lineWidth=t,this.$nativeGraphicsContext.lineWidth=t}),r(p,"strokeStyle",function(){return this.$strokeStyle},function(t){-1!=t.indexOf("rgba")?t=this.$parseRGBA(t):-1!=t.indexOf("rgb")&&(t=this.$parseRGB(t)),this.$strokeStyle=t,egret_native.Label.setStrokeColor(parseInt(t.replace("#","0x"))),this.$nativeGraphicsContext.strokeStyle=t}),r(p,"fillStyle",function(){return this.$fillStyle},function(t){-1!=t.indexOf("rgba")?t=this.$parseRGBA(t):-1!=t.indexOf("rgb")&&(t=this.$parseRGB(t)),this.$fillStyle=t,egret_native.Label.setTextColor(parseInt(t.replace("#","0x"))),this.$nativeGraphicsContext.fillStyle=t}),p.$fillColorStr=function(t){return t.length<2&&(t="0"+t),t},p.$parseRGBA=function(t){var e=t.indexOf("(");t=t.slice(e+1,t.length-1);var i=t.split(","),n=parseInt(255*parseFloat(i[3])).toString(16),r=parseInt(i[0]).toString(16),a=parseInt(i[1]).toString(16),s=parseInt(i[2]).toString(16);return t="#"+this.$fillColorStr(n)+this.$fillColorStr(r)+this.$fillColorStr(a)+this.$fillColorStr(s)},p.$parseRGB=function(t){var e=t.indexOf("(");t=t.slice(e+1,t.length-1);var i=t.split(","),n=parseInt(i[0]).toString(16),r=parseInt(i[1]).toString(16),a=parseInt(i[2]).toString(16);return t="#"+this.$fillColorStr(n)+this.$fillColorStr(r)+this.$fillColorStr(a)},r(p,"font",function(){return this.$font},function(t){this.$font=t;for(var e=t.split(" "),i=e.length,n=0;i>n;n++){var r=e[n];if(-1!=r.indexOf("px"))return void(this.$fontSize=parseInt(r.replace("px","")))}}),p.arc=function(t,e,i,n,r,a){this.$nativeGraphicsContext.arc(t,e,i,n,r,a)},p.quadraticCurveTo=function(t,e,i,n){this.$nativeGraphicsContext.quadraticCurveTo(t,e,i,n)},p.lineTo=function(t,e){this.$nativeGraphicsContext.lineTo(t,e)},p.fill=function(t){this.$nativeGraphicsContext.fill(t)},p.closePath=function(){this.$nativeGraphicsContext.closePath()},p.rect=function(t,e,i,n){this.$nativeGraphicsContext.rect(t,e,i,n),this.$clipRect.setTo(t,e,i,n)},p.moveTo=function(t,e){this.$nativeGraphicsContext.moveTo(t,e)},p.fillRect=function(t,e,i,n){this.$nativeGraphicsContext.fillRect(t,e,i,n)},p.bezierCurveTo=function(t,e,i,n,r,a){this.$nativeGraphicsContext.bezierCurveTo(t,e,i,n,r,a)},p.stroke=function(){this.$nativeGraphicsContext.stroke()},p.strokeRect=function(t,e,i,n){this.$nativeGraphicsContext.strokeRect(t,e,i,n)},p.beginPath=function(){this.$nativeGraphicsContext.beginPath()},p.arcTo=function(t,e,i,n,r){this.$nativeGraphicsContext.arcTo(t,e,i,n,r)},p.transform=function(t,e,i,n,r,a){this.$matrix.append(t,e,i,n,r,a),this.setTransformToNative()},p.translate=function(t,e){this.$matrix.translate(t,e),this.setTransformToNative()},p.scale=function(t,e){this.$matrix.scale(t,e),this.setTransformToNative()},p.rotate=function(t){this.$matrix.rotate(t),this.setTransformToNative()},p.restore=function(){if(this.$saveCount>0){if(this.$saveList.length){var t=this.$saveList.pop();for(var e in t)this[e]=t[e];this.setTransformToNative()}var i=this.$clipList.indexOf(this.$saveCount);if(-1!=i){var n=this.$clipList.length;for(this.$clipList.splice(i,n-i);n>i;i++)this.$nativeContext.popClip()}this.$saveCount--}},p.save=function(){var e=new t.Matrix;e.copyFrom(this.$matrix),this.$saveList.push({lineWidth:this.$lineWidth,globalCompositeOperation:this.$globalCompositeOperation,globalAlpha:this.$globalAlpha,strokeStyle:this.$strokeStyle,fillStyle:this.$fillStyle,font:this.$font,$matrix:e}),this.$saveCount++},p.clip=function(){this.$clipRect.width>0&&this.$clipRect.height>0&&(this.$nativeContext.pushClip(this.$clipRect.x,this.$clipRect.y,this.$clipRect.width,this.$clipRect.height),this.$clipRect.setEmpty(),this.$clipList.push(this.$saveCount))},p.clearRect=function(t,e,i,n){this.$nativeContext.clearRect(t,e,i,n)},p.setTransform=function(t,e,i,n,r,a){this.$matrix.setTo(t,e,i,n,r,a),this.setTransformToNative()},p.setTransformToNative=function(){var t=this.$matrix;this.$nativeContext.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)},p.createLinearGradient=function(t,e,i,n){return this.$nativeGraphicsContext.createLinearGradient(t,e,i,n)},p.createRadialGradient=function(t,e,i,n,r,a){return this.$nativeGraphicsContext.createRadialGradient(t,e,i,n,r,a)},p.fillText=function(e,i,n){var r=t.TextField.default_fontFamily;egret_native.Label.createLabel(r,this.$fontSize,"",this.$hasStrokeText?this.$lineWidth:0),this.$hasStrokeText=!1,egret_native.Label.drawText(e,i,n)},p.strokeText=function(){this.$hasStrokeText=!0},p.measureText=function(e){var i=t.TextField.default_fontFamily;return egret_native.Label.createLabel(i,this.$fontSize,"",this.$hasStrokeText?this.$lineWidth:0),{width:egret_native.Label.getTextSize(e)[0]}},p.drawImage=function(t,e,i,n,r,a,s,o,h){var c;c=t.$nativeRenderTexture?t.$nativeRenderTexture:t,c&&(3==arguments.length?(a=e,s=i,e=0,i=0,n=o=t.width,r=h=t.height):(n||(n=t.width),r||(r=t.height),a||(a=0),s||(s=0),o||(o=n),h||(h=r)),this.$nativeContext.drawImage(c,e,i,n,r,a,s,o,h))},p.createPattern=function(){return null},p.getImageData=function(t,e,i,n){return{width:i,height:n,data:null}},p.begin=function(){this.surface.begin()},p.end=function(){this.surface.end()},n}(t.HashObject);e.NativeRenderContext=n,t.registerClass(n,"egret.native.NativeRenderContext",["egret.sys.RenderContext"])}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=[],n=["source-over","lighter","destination-out"],r="source-over",a=function(a){function s(i){a.call(this),this.$isDirty=!1,this.$renderAlpha=1,this.$renderMatrix=new t.Matrix,this.$ratioMatrix=new t.Matrix,this.$ratioChanged=!1,this.$pixelRatio=1,this.$renderRegion=new e.Region,this.surface=null,this.offsetX=0,this.offsetY=0,this.needRedraw=!1,this.rootMatrix=new t.Matrix,this.dirtyNodes={},this.dirtyNodeList=[],this.dirtyList=null,this.dirtyRegion=new e.DirtyRegion,this.sizeChanged=!1,this.root=i}__extends(s,a);var o=s;return p=o.prototype,s.release=function(n){e.surfaceFactory.release(n.surface),t.Matrix.release(n.$renderMatrix),t.Matrix.release(n.$ratioMatrix),n.surface=null,n.renderContext=null,n.root=null,n.$renderMatrix=null,n.$ratioMatrix=null,n.needRedraw=!1,n.$isDirty=!1,i.push(n)},s.create=function(n){var r=i.pop();r||(r=new t.sys.DisplayList(n));var a=e.surfaceFactory.create();return a?(r.surface=a,r.renderContext=a.renderContext,r.root=n,r.$renderMatrix=t.Matrix.create(),r.$renderMatrix.setTo(1,0,0,1,0,0),r.$pixelRatio=1,r.$ratioMatrix=t.Matrix.create(),r.$ratioMatrix.setTo(1,0,0,1,0,0),r.needRedraw=!0,r.$isDirty=!0,r):null},p.$update=function(){var t=this.root;if(null==t)return!1;t.$removeFlagsUp(768),this.$renderAlpha=t.$getConcatenatedAlpha();var e=t.$getConcatenatedMatrix(),i=t.$getOriginalBounds(),n=t.$parentDisplayList,r=1;n?r=n.$pixelRatio:t.stage&&t.stage.$displayList&&(r=t.stage.$displayList.$pixelRatio),this.setDevicePixelRatio(r);var a=this.$renderRegion;if(this.needRedraw&&this.updateDirtyRegions(),!n)return a.setTo(0,0,0,0),a.moved=!1,!1;if(!a.moved&&!n.$ratioChanged)return!1;a.moved=!1;var s=this.$renderMatrix;s.copyFrom(e);var o=n.root;return o!==t.$stage&&t.$getConcatenatedMatrixAt(o,s),this.$ratioMatrix.$preMultiplyInto(s,s),a.updateRegion(i,s),!0},p.$render=function(t){var e=this.surface;e&&(t.begin(),t.drawImage(e,this.offsetX,this.offsetY,e.width/this.$pixelRatio,e.height/this.$pixelRatio),t.end())},p.setClipRect=function(t,e){t*=this.$pixelRatio,e*=this.$pixelRatio,this.dirtyRegion.setClipRect(t,e),this.rootMatrix=null;var i=this.renderContext.surface;i.width=t,i.height=e,this.surface=i},p.markDirty=function(t){var e=t.$hashCode;if(!this.dirtyNodes[e]&&(this.dirtyNodes[e]=!0,this.dirtyNodeList.push(t),!this.needRedraw)){this.needRedraw=!0;var i=this.root.$parentDisplayList;i&&i.markDirty(this)}},p.updateDirtyRegions=function(){var t=this.dirtyNodeList;this.dirtyNodeList=[],this.dirtyNodes={};for(var e=this.dirtyRegion,i=t.length,n=0;i>n;n++){var r=t[n],a=r.$renderRegion;r.$renderAlpha>0&&e.addRegion(a)&&(r.$isDirty=!0);var s=r.$update();r.$renderAlpha>0&&(s||!r.$isDirty)&&e.addRegion(a)&&(r.$isDirty=!0)}return this.dirtyList=e.getDirtyRegions(),this.dirtyList},p.drawToSurface=function(){var t=this.rootMatrix;t&&this.changeSurfaceSize();var e=this.renderContext;e.begin(),e.save(),e.beginPath(),t&&e.setTransform(1,0,0,1,-this.offsetX*this.$pixelRatio,-this.offsetY*this.$pixelRatio);var i=this.dirtyList;this.dirtyList=null;for(var n=i.length,r=0;n>r;r++){var a=i[r];e.clearRect(a.minX,a.minY,a.width,a.height),e.rect(a.minX,a.minY,a.width,a.height)}e.clip(),t&&e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.end();var s=this.drawDisplayObject(this.root,e,i,t,null,null);return e.begin(),e.restore(),e.end(),this.dirtyRegion.clear(),this.needRedraw=!1,this.$ratioChanged=!1,s},p.drawDisplayObject=function(t,e,i,n,r,a){var s,o,h=0;if(r?(r.needRedraw&&(h+=r.drawToSurface()),s=r,o=1):t.$renderRegion&&(s=t,o=t.$renderAlpha),s){var c=s.$renderRegion;if(a&&!a.intersects(c))s.$isDirty=!1;else if(!s.$isDirty)for(var u=i.length,l=0;u>l;l++)if(c.intersects(i[l])){s.$isDirty=!0;break}if(s.$isDirty){h++,e.begin(),e.globalAlpha=o;var d=s.$renderMatrix;n?(e.transform(d.a,d.b,d.c,d.d,d.tx,d.ty),s.$render(e),e.setTransform(n.a,n.b,n.c,n.d,n.tx*this.$pixelRatio,n.ty*this.$pixelRatio)):(e.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty),s.$render(e)),e.end(),s.$isDirty=!1}}if(r)return h;var p=t.$children;if(p)for(var v=p.length,f=0;v>f;f++){var g=p[f];!g.$visible||g.$alpha<=0||g.$maskedObject||(h+=0!==g.$blendMode||g.$mask&&g.$mask.$parentDisplayList?this.drawWithClip(g,e,i,n,a):g.$scrollRect||g.$maskRect?this.drawWithScrollRect(g,e,i,n,a):this.drawDisplayObject(g,e,i,n,g.$displayList,a))}return h},p.drawWithClip=function(i,a,s,o,h){var c=0,u=0!==i.$blendMode;if(u){var l=n[i.$blendMode];l||(l=r)}var d=i.$scrollRect?i.$scrollRect:i.$maskRect,p=i.$mask;p&&!p.$parentDisplayList&&(p=null);var v,f=t.Matrix.create();f.copyFrom(i.$getConcatenatedMatrix());var g,$=i.$parentDisplayList.root;if($!==i.$stage&&(g=$.$getInvertedConcatenatedMatrix(),g.$preMultiplyInto(f,f)),this.$ratioMatrix.$preMultiplyInto(f,f),p){var x=p.$getOriginalBounds();v=e.Region.create();var y=t.Matrix.create();y.copyFrom(p.$getConcatenatedMatrix()),g&&g.$preMultiplyInto(y,y),this.$ratioMatrix.$preMultiplyInto(y,y),v.updateRegion(x,y),t.Matrix.release(y)}var R;if(d&&(R=e.Region.create(),R.updateRegion(d,f)),R&&v?(R.intersect(v),e.Region.release(v)):!R&&v&&(R=v),R){if(R.isEmpty()||h&&!h.intersects(R))return e.Region.release(R),t.Matrix.release(f),c}else R=e.Region.create(),x=i.$getOriginalBounds(),R.updateRegion(x,f);for(var T=!1,m=s.length,C=0;m>C;C++)if(R.intersects(s[C])){T=!0;break}if(!T)return e.Region.release(R),t.Matrix.release(f),c;var w=this.createRenderContext(R.width,R.height);if(!w)return c+=this.drawDisplayObject(i,a,s,o,i.$displayList,h),e.Region.release(R),t.Matrix.release(f),c;if(w.begin(),d){var y=f;w.setTransform(y.a,y.b,y.c,y.d,y.tx-R.minX,y.ty-R.minY),w.beginPath(),w.rect(d.x,d.y,d.width,d.height),w.clip()}w.setTransform(1,0,0,1,-R.minX,-R.minY),w.end();var _=t.Matrix.create().setTo(1,0,0,1,-R.minX,-R.minY);if(c+=this.drawDisplayObject(i,w,s,_,i.$displayList,R),t.Matrix.release(_),p){var b=this.createRenderContext(R.width,R.height);if(!b)return c+=this.drawDisplayObject(i,a,s,o,i.$displayList,h),e.surfaceFactory.release(w.surface),e.Region.release(R),t.Matrix.release(f),c;b.begin(),b.setTransform(1,0,0,1,-R.minX,-R.minY),b.end(),_=t.Matrix.create().setTo(1,0,0,1,-R.minX,-R.minY);var E=this.drawDisplayObject(p,b,s,_,p.$displayList,R);t.Matrix.release(_),E>0&&(c+=E,w.begin(),w.globalCompositeOperation="destination-in",w.setTransform(1,0,0,1,0,0),w.globalAlpha=1,w.drawImage(b.surface,0,0),w.end()),e.surfaceFactory.release(b.surface)}return c>0&&(c++,a.begin(),u&&(a.globalCompositeOperation=l),o?(a.translate(R.minX,R.minY),a.drawImage(w.surface,0,0),a.setTransform(o.a,o.b,o.c,o.d,o.tx*this.$pixelRatio,o.ty*this.$pixelRatio)):(a.setTransform(1,0,0,1,R.minX,R.minY),a.drawImage(w.surface,0,0)),u&&(a.globalCompositeOperation=r),a.end()),e.surfaceFactory.release(w.surface),e.Region.release(R),t.Matrix.release(f),c},p.drawWithScrollRect=function(i,n,r,a,s){var o=0,h=i.$scrollRect?i.$scrollRect:i.$maskRect,c=t.Matrix.create();c.copyFrom(i.$getConcatenatedMatrix());var u=i.$parentDisplayList.root;u!==i.$stage&&u.$getInvertedConcatenatedMatrix().$preMultiplyInto(c,c),this.$ratioMatrix.$preMultiplyInto(c,c);var l=e.Region.create();if(h.isEmpty()||l.updateRegion(h,c),l.isEmpty()||s&&!s.intersects(l))return e.Region.release(l),t.Matrix.release(c),o;for(var d=!1,p=r.length,v=0;p>v;v++)if(l.intersects(r[v])){d=!0;break}return d?(n.begin(),n.save(),a?(n.setTransform(a.a,a.b,a.c,a.d,a.tx*this.$pixelRatio,a.ty*this.$pixelRatio),n.transform(c.a,c.b,c.c,c.d,c.tx,c.ty)):n.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty),n.beginPath(),n.rect(h.x,h.y,h.width,h.height),n.clip(),a&&n.setTransform(a.a,a.b,a.c,a.d,a.tx*this.$pixelRatio,a.ty*this.$pixelRatio),n.end(),o+=this.drawDisplayObject(i,n,r,a,i.$displayList,l),n.begin(),n.restore(),n.end(),e.Region.release(l),t.Matrix.release(c),o):(e.Region.release(l),t.Matrix.release(c),o)},p.createRenderContext=function(i,n){var r=e.surfaceFactory.create(!0);return r?(t.Capabilities.runtimeType==t.RuntimeType.WEB?(r.width=Math.max(257,i),r.height=Math.max(257,n)):(r.width=i,r.height=n),r.renderContext):null},p.changeSurfaceSize=function(){var t=(this.root,this.offsetX),i=this.offsetY,n=this.root.$getOriginalBounds(),r=this.$pixelRatio,a=this.$pixelRatio;this.offsetX=n.x,this.offsetY=n.y;var s=this.renderContext,o=s.surface;if(this.sizeChanged){var h=e.sharedRenderContext,c=h.surface;e.sharedRenderContext=s,this.renderContext=h,this.surface=c,c.width=n.width*r,c.height=n.height*a,0!==o.width&&0!==o.height&&(h.begin(),h.setTransform(1,0,0,1,0,0),h.drawImage(o,(t-this.offsetX)*r,(i-this.offsetY)*a),h.end()),o.height=1,o.width=1}else this.sizeChanged=!0,o.width=n.width*r,o.height=n.height*a;this.rootMatrix.setTo(1,0,0,1,-this.offsetX,-this.offsetY),this.renderContext.begin(),this.renderContext.setTransform(1,0,0,1,-n.x,-n.y),this.renderContext.end()},p.setDevicePixelRatio=function(e){void 0===e&&(e=1),this.$pixelRatio==e&&this.$ratioMatrix||(this.$ratioMatrix||(this.$ratioMatrix=t.Matrix.create()),this.$ratioChanged=!0,this.$pixelRatio=e,this.$ratioMatrix.setTo(e,0,0,e,0,0),this.root.$invalidate(!0))},s}(t.HashObject);e.NativeDisplayList=a,t.registerClass(a,"egret.sys.NativeDisplayList",["egret.sys.Renderable"]),t.sys.DisplayList=t.sys.NativeDisplayList}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function i(){t.call(this),this.renderContext=new e.NativeRenderContext,this.$widthReadySet=!1,this.$heightReadySet=!1,this.$isRoot=!1,this.$isDispose=!1}__extends(i,t);var n=__define,r=i;return p=r.prototype,p.toDataURL=function(){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return this.$nativeRenderTexture?this.$nativeRenderTexture.toDataURL.apply(this,arguments):null},p.saveToFile=function(t,e){this.$nativeRenderTexture&&this.$nativeRenderTexture.saveToFile(t,e)},n(p,"width",function(){return this.$width},function(t){this.$width=t,this.$isDispose||(this.$widthReadySet=!0,this.createRenderTexture())}),n(p,"height",function(){return this.$height},function(t){this.$height=t,this.$isDispose||(this.$heightReadySet=!0,this.createRenderTexture())}),p.createRenderTexture=function(){this.$isRoot||this.$widthReadySet&&this.$heightReadySet&&(this.$nativeRenderTexture&&this.$nativeRenderTexture.dispose(),this.$nativeRenderTexture=new egret_native.RenderTexture(this.$width,this.$height),this.$widthReadySet=!1,this.$heightReadySet=!1)},p.begin=function(){this.$nativeRenderTexture&&this.$nativeRenderTexture.begin()},p.end=function(){this.$nativeRenderTexture&&this.$nativeRenderTexture.end()},p.$dispose=function(){this.$nativeRenderTexture&&(this.$nativeRenderTexture.dispose(),this.$nativeRenderTexture=null),this.$isDispose=!0},p.$reload=function(){this.$isDispose=!1},i}(t.HashObject);e.NativeSurface=i,t.registerClass(i,"egret.native.NativeSurface",["egret.sys.Surface","egret.BitmapData"])}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(){function e(e,i){var n=t.sys.surfaceFactory.create(!0);if(!n)return null;var r=e.$getTextureWidth(),a=e.$getTextureHeight();null==i&&(i=t.$TempRectangle,i.x=0,i.y=0,i.width=r,i.height=a),i.x=Math.min(i.x,r-1),i.y=Math.min(i.y,a-1),i.width=Math.min(i.width,r-i.x),i.height=Math.min(i.height,a-i.y);var s=i.width,o=i.height;n.width=s,n.height=o;var h=e,c=n.renderContext;c.begin(),c.imageSmoothingEnabled=!1;var u=Math.round(h._offsetX),l=Math.round(h._offsetY),d=h._bitmapWidth,p=h._bitmapHeight;return c.globalAlpha=1,c.globalCompositeOperation="source-over",c.setTransform(1,0,0,1,0,0),c.drawImage(h._bitmapData,h._bitmapX+i.x/t.$TextureScaleFactor,h._bitmapY+i.y/t.$TextureScaleFactor,d*i.width/r,p*i.height/a,u,l,i.width,i.height),c.end(),n}function i(i,n){try{var r=e(this,n),a=r.toDataURL(i);return r.$dispose(),a}catch(s){return t.$error(1033),null}}function n(i,n,r){try{var a=e(this,r);a.saveToFile(i,n),a.$dispose()}catch(s){t.$error(1033)}}function r(){return t.$error(1035),null}t.Texture.prototype.toDataURL=i,t.Texture.prototype.saveToFile=n,t.Texture.prototype.getPixel32=r}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=[],n=function(){function n(){t.sys.sharedRenderContext=this.create().renderContext;for(var e=0;3>e;e++)i.push(this.create())}var r=n;return p=r.prototype,p.create=function(t){var n=t||i.length>3?i.pop():null;return n||(n=this.createSurface(new e.NativeSurface)),n.$reload(),n},p.release=function(t){t&&(t.$dispose(),t.width=t.height=1,i.push(t))},p.createSurface=function(t){var e=t.renderContext;return e.surface=t,t},n}();e.OpenGLFactory=n,t.registerClass(n,"egret.native.OpenGLFactory",["egret.sys.SurfaceFactory"])}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(i){function n(){i.call(this),this.init(n.option)}__extends(n,i);var r=n;return p=r.prototype,p.init=function(i){i.showPaintRect=!1;var n=new t.Stage;n.$screen=this,n.$scaleMode=i.scaleMode,n.$maxTouches=i.maxTouches,n.frameRate=i.frameRate,n.textureScaleFactor=i.textureScaleFactor;var r=t.sys.surfaceFactory.create();r.$isRoot=!0;var a=new e.NativeTouchHandler(n),s=new t.sys.Player(r.renderContext,n,i.entryClassName);new e.NativeHideHandler(n);this.playerOption=i,this.stage=n,this.player=s,this.nativeTouch=a,this.updateScreenSize(),this.updateMaxTouches(),s.start()},p.updateScreenSize=function(){var e=this.playerOption,i=egret_native.EGTView.getFrameWidth(),n=egret_native.EGTView.getFrameHeight(),r=t.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,i,n,e.contentWidth,e.contentHeight),a=r.stageWidth,s=r.stageHeight,o=r.displayWidth,h=r.displayHeight,c=(n-h)/2,u=(i-o)/2;egret_native.EGTView.setVisibleRect(u,c,o,h),egret_native.EGTView.setDesignSize(a,s),this.player.updateStageSize(a,s)},p.updateMaxTouches=function(){this.nativeTouch.$updateMaxTouches()},n}(t.HashObject);e.NativePlayer=i,t.registerClass(i,"egret.native.NativePlayer",["egret.sys.Screen"])}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){function i(){var i=t.sys.$ticker,n=function(){i.update()};egret_native.executeMainLoop(n,i),t.sys.surfaceFactory=new e.OpenGLFactory,t.sys.screenAdapter||(t.sys.screenAdapter=new t.sys.ScreenAdapter),new e.NativePlayer}function n(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e}t.warn=function(){console.warn.apply(console,n(arguments))},t.error=function(){console.error.apply(console,n(arguments))},t.assert=function(){console.assert.apply(console,n(arguments))},t.log=function(){console.log.apply(console,n(arguments))},t.runEgret=i}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){function i(t){return egret_native.getOption(t)}e.getOption=i,t.getOption=i}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){function i(e){var i=JSON.parse(e),r=i.functionName,a=n[r];if(a){var s=i.value;a.call(null,s)}else t.$warn(1004,r)}var n={},r=function(){function t(){}var e=t;return p=e.prototype,t.call=function(t,e){var i={};i.functionName=t,i.value=e,egret_native.sendInfoToPlugin(JSON.stringify(i))},t.addCallback=function(t,e){n[t]=e},t}();e.NativeExternalInterface=r,t.registerClass(r,"egret.native.NativeExternalInterface",["egret.ExternalInterface"]),t.ExternalInterface=r,egret_native.receivedPluginInfo=i}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i;!function(){function i(t){return h[t]}function n(e,i){h[e]=i;try{return this.save(),!0}catch(n){return t.$warn(1018,e,i),!1}}function r(t){delete h[t],s()}function a(){for(var t in h)delete h[t];s()}function s(){egret_native.saveRecord(o,JSON.stringify(h))}var o="LocalStorage.local",h={};if(egret_native.isRecordExists(o)){var c=egret_native.loadRecord(o);h=JSON.parse(c)}else h={};e.getItem=i,e.setItem=n,e.removeItem=r,e.clear=a}(i=e["native"]||(e["native"]={}))}(e=t.localStorage||(t.localStorage={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(i){function n(e){var n=this;i.call(this),this.$startTime=0,this.audio=null,this.isStopped=!1,this.onPlayEnd=function(){return 1==n.$loops?(n.stop(),void n.dispatchEventWith(t.Event.SOUND_COMPLETE)):(n.$loops>0&&n.$loops--,n.audio.load(),void n.$play())},e.addEventListener("ended",this.onPlayEnd),this.audio=e}__extends(n,i);var r=__define,a=n;return p=a.prototype,p.$play=function(){if(this.isStopped)return void t.$error(1036);try{this.audio.currentTime=this.$startTime}catch(e){}finally{this.audio.play()}},p.stop=function(){if(this.audio){var t=this.audio;t.pause(),t.removeEventListener("ended",this.onPlayEnd),this.audio=null,e.NativeSound.$recycle(this.$url,t)}},r(p,"volume",function(){return this.audio?this.audio.volume:1},function(e){return this.isStopped?void t.$error(1036):void(this.audio&&(this.audio.volume=e))}),r(p,"position",function(){return this.audio?this.audio.currentTime:0}),n}(t.EventDispatcher);e.NativeSoundChannel=i,t.registerClass(i,"egret.web.NativeSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(i){e.call(this),egret_native.pauseApp=function(){i.dispatchEvent(new t.Event(t.Event.DEACTIVATE)),egret_native.Audio.pauseBackgroundMusic(),egret_native.Audio.pauseAllEffects()},egret_native.resumeApp=function(){i.dispatchEvent(new t.Event(t.Event.ACTIVATE)),egret_native.Audio.resumeBackgroundMusic(),egret_native.Audio.resumeAllEffects()}}__extends(i,e);var n=i;return p=n.prototype,i}(t.HashObject);e.NativeHideHandler=i,t.registerClass(i,"egret.native.NativeHideHandler")}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.apply(this,arguments),this._downCount=0,this._path=null,this._bytesTotal=0}__extends(i,e);var n=i;return p=n.prototype,p.load=function(t,e){this._downCount=0,this._path=t,this._bytesTotal=e,this.reload()},p.reload=function(){if(this._downCount>=3)return void this.downloadFileError();this._downCount++;var e=t.PromiseObject.create(),i=this;e.onSuccessFunc=function(){i.loadOver()},e.onErrorFunc=function(){i.reload()},e.downloadingSizeFunc=function(t){i.downloadingProgress(t)},egret_native.download(this._path,this._path,e)},p.downloadingProgress=function(e){t.ProgressEvent.dispatchProgressEvent(this,t.ProgressEvent.PROGRESS,e,this._bytesTotal)},p.downloadFileError=function(){this.dispatchEvent(new t.Event(t.IOErrorEvent.IO_ERROR))},p.loadOver=function(){this.dispatchEvent(new t.Event(t.Event.COMPLETE))},i}(t.EventDispatcher);t.NativeResourceLoader=e,t.registerClass(e,"egret.NativeResourceLoader")}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(i){e.call(this),this.$touch=new t.sys.TouchHandler(i);var n=this;egret_native.onTouchesBegin=function(t,e,i,r){n.$executeTouchCallback(t,e,i,r,n.$touch.onTouchBegin)},egret_native.onTouchesMove=function(t,e,i,r){n.$executeTouchCallback(t,e,i,r,n.$touch.onTouchMove)},egret_native.onTouchesEnd=function(t,e,i,r){n.$executeTouchCallback(t,e,i,r,n.$touch.onTouchEnd)},egret_native.onTouchesCancel=function(){}}__extends(i,e);var n=i;return p=n.prototype,p.$executeTouchCallback=function(t,e,i,n,r){for(var a=0;t>a;a++){var s=e[a],o=i[a],h=n[a];r.call(this.$touch,o,h,s)}},p.$updateMaxTouches=function(){this.$touch.$initMaxTouches()},i}(t.HashObject);e.NativeTouchHandler=i,t.registerClass(i,"egret.native.NativeTouchHandler")}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._url="",this._method=""}__extends(i,e);var n=__define,r=i;return p=r.prototype,n(p,"response",function(){return this._response}),n(p,"responseType",function(){return this._responseType},function(t){this._responseType=t}),n(p,"withCredentials",function(){return this._withCredentials},function(t){this._withCredentials=t}),p.open=function(t,e){void 0===e&&(e="GET"),this._url=t,this._method=e},p.send=function(){function e(){var e=new t.PromiseObject;e.onSuccessFunc=function(e){r._response=e,t.Event.dispatchEvent(r,t.Event.COMPLETE)},egret_native.readFileAsync(r._url,e)}function i(){var e=t.PromiseObject.create();e.onSuccessFunc=n,e.onErrorFunc=function(){t.Event.dispatchEvent(r,t.IOErrorEvent.IO_ERROR)},egret_native.download(r._url,r._url,e)}function n(){var e=egret_native.readFileSync(r._url);r._response=e,t.Event.dispatchEvent(r,t.Event.COMPLETE)}var r=this;egret_native.isFileExists(r._url)?e():i()},p.abort=function(){},p.getAllResponseHeaders=function(){return""},p.setRequestHeader=function(t,e){this.header=t,this.headerValue=e},p.getResponseHeader=function(){return""},i}(t.EventDispatcher);e.NativeHttpRequest=i,t.registerClass(i,"egret.native.NativeHttpRequest",["egret.HttpRequest"]),t.HttpRequest=i}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(i){function n(){i.apply(this,arguments),this.data=null,this.crossOrigin=null}__extends(n,i);var r=n;return p=r.prototype,p.load=function(t){this.check(t)},p.check=function(t){var e=this;e.isNetUrl(t)?e.download(t):egret_native.isFileExists(t)?e.loadTexture(t):e.download(t)},p.download=function(e){var i=this,n=t.PromiseObject.create();n.onSuccessFunc=function(){i.loadTexture(e)},n.onErrorFunc=function(){i.dispatchEventWith(t.IOErrorEvent.IO_ERROR)},egret_native.download(e,e,n)},p.loadTexture=function(i){var n=this,r=new t.PromiseObject;r.onSuccessFunc=function(i){n.data=e.toBitmapData(i),n.dispatchEventWith(t.Event.COMPLETE)},r.onErrorFunc=function(){n.dispatchEventWith(t.IOErrorEvent.IO_ERROR)},egret_native.Texture.addTextureAsyn(i,r)},p.isNetUrl=function(t){return-1!=t.indexOf("http://")},n}(t.EventDispatcher);e.NativeImageLoader=i,t.registerClass(i,"egret.native.NativeImageLoader",["egret.ImageLoader"]),t.ImageLoader=i}(e=t["native"]||(t["native"]={}))}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.textValue="",this.isFinishDown=!1,this.textValue=""}__extends(i,e);var n=i;return p=n.prototype,p.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},p.$setText=function(t){return this.textValue=t,!0},p.$onBlur=function(){},p.showScreenKeyboard=function(){var e=this;e.dispatchEvent(new t.Event("focus")),t.Event.dispatchEvent(e,"focus",!1,{showing:!0}),egret_native.EGT_TextInput=function(i){e.$textfield.multiline?e.isFinishDown&&(e.isFinishDown=!1,e.textValue=i,e.dispatchEvent(new t.Event("updateText"))):(e.textValue=i.replace(/[\n|\r]/,""),egret_native.TextInputOp.setKeybordOpen(!1),e.dispatchEvent(new t.Event("updateText")),e.dispatchEvent(new t.Event("blur")))},egret_native.EGT_keyboardFinish=function(){e.$textfield.multiline&&(e.isFinishDown=!0),e.dispatchEvent(new t.Event("blur"))}},p.$show=function(){var t=this;egret_native.EGT_getTextEditerContentText=function(){return t.$getText()},egret_native.EGT_keyboardDidShow=function(){t.showScreenKeyboard(),egret_native.EGT_keyboardDidShow=function(){}};var e=this.$textfield,i=e.multiline?0:6,n=-1,r=1,a=e.maxChars<=0?-1:e.maxChars;egret_native.TextInputOp.setKeybordOpen(!0,JSON.stringify({inputMode:i,inputFlag:n,returnType:r,maxLength:a}))},p.$hide=function(){this.dispatchEvent(new t.Event("blur")),egret_native.TextInputOp.setKeybordOpen(!1)},p.$resetStageText=function(){},p.$addToStage=function(){},p.$removeFromStage=function(){},p.$setTextField=function(t){return this.$textfield=t,!0},i}(t.EventDispatcher);t.NativeStageText=e,t.registerClass(e,"egret.NativeStageText",["egret.StageText"]),t.StageText=e}(egret||(egret={}));